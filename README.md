# Pocket - Flow Trainer

Master your flow with A-B looping and precision speed control for the Spotify Web Player.

Whether you want to **slow down Spotify** to practice music, or you need a reliable **Spotify speed controller** to learn lyrics, Pocket has you covered. By injecting advanced playback controls right into the normal player interface, Pocket acts as the ultimate **Spotify playback speed** and **AB loop Spotify** extension.

It operates in the "Main World" of the browser to bypass typical restrictions, letting you seamlessly **change Spotify speed** and loop accurately.

## Features

- **Precision Speed Control:** Alter playback speed from 0.25x to 4.0x without the "chipmunk" pitch shift (pitch preservation toggleable). The best way to **change Spotify speed**.
- **A-B Looping:** Set custom start (A) and end (B) points to seamlessly loop specific sections of a song. The ideal **Spotify loop extension** to **practice music on Spotify**, transcribe solos, or analyze tracks.
- **Native UI Integration:** Controls are seamlessly embedded right into Spotify's own Player Control Bar using Shadow DOM to prevent CSS conflicts. It feels like a native Spotify feature.
- **Just-In-Time (JIT) Resolution:** Intelligently finds the active audio stream even as Spotify dynamically creates and destroys video/audio elements in its Single Page Application (SPA) architecture.

## Tech Stack

- **Framework:** React 19 + TypeScript
- **Build Tool:** Vite 7 + `@crxjs/vite-plugin`
- **Styling:** Tailwind CSS 4 (Injected via Shadow DOM)
- **Extension Type:** Chrome Extension (Manifest V3)

## How it Works

Because Spotify uses encrypted media (EME/DRM) and complex state management, standard Chrome Extension content scripts (which run in an "Isolated World") cannot interact with the player.

Pocket solves this by injecting a script directly into the **Main World**. It hijacks `document.createElement` to intercept `<video>` and `<audio>` tags as Spotify creates them, and proxies the `playbackRate` setter to enforce user-selected speeds even when Spotify attempts to reset them on track changes.

## Development Setup

### 1. Installation

```bash
# Clone the repository
git clone <repository-url>
cd pocket

# Install dependencies
npm install
```

### 2. Running Locally

```bash
npm run dev
```

### 3. Loading the Extension in Chrome

1. Open Chrome and navigate to `chrome://extensions`.
2. Turn on **Developer Mode** (toggle in the top right).
3. Click **Load Unpacked**.
4. Select the `dist` folder generated by Vite in the `pocket` directory.
5. Open [Spotify Web Player](https://open.spotify.com/) and start listening! The Vite Dev Server will HMR (Hot Module Replace) any changes you make to the code directly in the browser.

## Build for Production

To create a production build and generate a `.zip` file for the Chrome Web Store:

```bash
npm run build
```

This will compile the TypeScript, bundle the assets, and output a `release.zip` file containing your production-ready extension.

## Permissions Required

- `host_permissions` for `https://open.spotify.com/*` to allow script injection.
- `storage` to remember your speed, pitch preferences, and loops across sessions.
